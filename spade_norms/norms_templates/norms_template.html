{% extends "internal_tpl_base.html" %}

{% block content_title %}Normative Component{% endblock %}
{% block content %}
<!-- Main content -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-python.min.js"></script>
<section class="content">
    <div class="row">
        <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Norms</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
                        <i class="fas fa-minus"></i>
                    </button>
                    <button type="button" class="btn btn-tool" data-card-widget="remove" title="Remove">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>
            <div class="card-body p-0">
                <table class="table table-striped projects">
                    <thead>
                    <tr>
                        <th style="width: 1%">
                            #
                        </th>
                        <th style="width: 5%">
                            Domain
                        </th>
                        <th style="width: 20%">
                            Norm Name
                        </th>
                        <th style="width: 15%">
                            Norm Type
                        </th>
                        <th style="width: 5%">
                            Condition function
                        </th>
                        <th style="width: 5%">
                            Reward function
                        </th>
                        <th style="width: 5%">
                            Penalty function
                        </th>
                        <th style="width: 20%">
                            Roles
                        </th>
                        <th style="width: 5%">
                            Inviolable
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for domain, norms in norms_db.items() %}
                    {% for norm in norms %}
                    <tr>
                        <td>
                            {{ loop.index }}
                        </td>
                        <td>
                            <small class="badge btn-primary">{{ domain }}</small>
                        </td>

                        <td>
                            {{ norm.name }}
                        </td>
                        <td>
                            {{ norm.norm_type }}
                        </td>
                        <td class="project-actions text-right">
                            <a class="btn btn-primary btn-sm"
                               data-toggle="modal" data-target="#modal-cond-{{ domain | replace(".", "-") }}-{{loop.index}}" href="#">
                                <i class="fas fa-folder">
                                </i>
                                View
                            </a>
                        </td>
                        <td class="project-actions text-right">
                            <a class="btn btn-primary btn-sm {{ 'disabled' if norm.reward_cb is none else '' }}"
                               data-toggle="modal" data-target="#modal-reward-{{ domain | replace(".", "-") }}-{{loop.index}}" href="#">
                                <i class="fas fa-folder">
                                </i>
                                View
                            </a>
                        </td>
                        <td class="project-actions text-right">
                            <a class="btn btn-primary btn-sm {{ 'disabled' if norm.penalty_cb is none else '' }}"
                               data-toggle="modal" data-target="#modal-penalty-{{ domain | replace(".", "-") }}-{{loop.index}}" href="#">
                                <i class="fas fa-folder">
                                </i>
                                View
                            </a>
                        </td>
                        <td>{% for role in norm.roles %}
                            <small class="badge btn-primary">{{ role }}</small>
                            {% endfor %}
                        </td>
                        <td>
                            {% if norm.inviolable %}
                            <i class="fas fa-check-circle text-success"></i>
                            {% else %}
                            <i class="fas fa-times-circle text-danger"></i>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                    {% endfor %}
                    </tbody>
                </table>
            </div>

        </div>
        <!-- /.card -->
        </div>
        <!-- /.col -->
    </div>
    <!-- /.row -->
</section>
<!-- /.content -->


{% for domain, norms in norms_db.items() %}
{% for norm in norms %}
<!-- Modal -->
{% if norm.condition_fn %}
<div class="modal fade" id="modal-cond-{{ domain | replace(".", "-") }}-{{loop.index}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="modal-cond-title-{{ domain | replace(".", "-") }}-{{loop.index}}">Condition function</h4>
      </div>
      <div class="modal-body">
        <pre><code class="language-python">{{ norm.condition_fn | function_to_string }}
        </code></pre>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% if norm.reward_cb %}
<div class="modal fade" id="modal-reward-{{ domain | replace(".", "-") }}-{{loop.index}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="modal-reward-title-{{ domain | replace(".", "-") }}-{{loop.index}}">Condition function</h4>
      </div>
      <div class="modal-body">
        <pre><code class="language-python">{{ norm.reward_cb | function_to_string }}
        </code></pre>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% if norm.penalty_cb %}
<div class="modal fade" id="modal-penalty-{{ domain | replace(".", "-") }}-{{loop.index}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="modal-penalty-title-{{ domain | replace(".", "-") }}-{{loop.index}}">Condition function</h4>
      </div>
      <div class="modal-body">
        <pre><code class="language-python">{{ norm.penalty_cb | function_to_string }}
        </code></pre>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endfor %}
{% endfor %}


{% endblock %}

